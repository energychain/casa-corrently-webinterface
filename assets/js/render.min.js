$(document).ready((function(){let t=!0,e="last24h",i=9999,s=9999,a=-1,o="./msg",n=0;void 0!==$.getUrlVar("reset")&&window.localStorage.removeItem("msg"),void 0!==$.getUrlVar("s")?(e=$.getUrlVar("s"),"last24h"==e&&$("#selectorLabel").html("Die letzten 24 Stunden"),"last7d"==e&&$("#selectorLabel").html("Die letzten 7 Tage"),"last30d"==e&&$("#selectorLabel").html("Die letzten 30 Tage"),"last365d"==e&&$("#selectorLabel").html("Die letzten 365 Tage")):$("#selectorLabel").html("Die letzten 24 Stunden");const l=function(){try{if(void 0!==window.localStorage.getItem("msg")&&null!==window.localStorage.getItem("msg")){let o=JSON.parse(window.localStorage.getItem("msg"));if(i!==o.stats[e].energyPrice_kwh&&(9999!==i&&(i<o.stats[e].energyPrice_kwh&&($("#priceUp").show(),$("#priceDown").hide(),$("#energyPrice_kwh").addClass("corrently_orange"),$("#energyPrice_kwh").removeClass("corrently_green")),i>o.stats[e].energyPrice_kwh&&($("#priceUp").hide(),$("#priceDown").show(),$("#energyPrice_kwh").removeClass("corrently_orange"),$("#energyPrice_kwh").addClass("corrently_green"))),i=o.stats[e].energyPrice_kwh),s!==o.stats[e].incomeSaldo&&(9999!==s&&(s<o.stats[e].incomeSaldo&&($("#costDown").show(),$("#costUp").hide(),$("#incomeSaldo").addClass("corrently_green"),$("#incomeSaldo").removeClass("corrently_orange")),s>o.stats[e].incomeSaldo&&($("#costDown").hide(),$("#costUp").show(),$("#incomeSaldo").addClass("corrently_orange"),$("#incomeSaldo").removeClass("corrently_green"))),s=o.stats[e].incomeSaldo),$("#energyPrice_kwh").html((100*o.stats[e].energyPrice_kwh).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),$("#last24h").html((100*o.stats.last24h.energyPrice_kwh).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last7d&&$("#last7d").html((100*o.stats.last7d.energyPrice_kwh).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last30d&&$("#last30d").html((100*o.stats.last30d.energyPrice_kwh).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last365d&&$("#last365d").html((100*o.stats.last365d.energyPrice_kwh).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".updateTS").html(new Date(o.time).toLocaleString()),$("#e24h").html(o.stats.last24h.energyRevenue.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last7d&&$("#e7d").html(o.stats.last7d.energyRevenue.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last30d&&$("#e30d").html(o.stats.last30d.energyRevenue.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last365d&&$("#e365d").html(o.stats.last365d.energyRevenue.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),$("#a24h").html(o.stats.last24h.energySpendings.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last7d&&$("#a7d").html(o.stats.last7d.energySpendings.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last30d&&$("#a30d").html(o.stats.last30d.energySpendings.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last365d&&$("#a365d").html(o.stats.last365d.energySpendings.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),$("#incomeSaldo").html((-1*o.stats[e].incomeSaldo).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),$("#s24h").html((-1*o.stats.last24h.incomeSaldo).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})),void 0!==o.stats.last7d?$("#s7d").html((-1*o.stats.last7d.incomeSaldo).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})):$(".row7d").hide(),void 0!==o.stats.last30d?$("#s30d").html((-1*o.stats.last30d.incomeSaldo).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})):$(".row30d").hide(),void 0!==o.stats.last365d?$("#s365d").html((-1*o.stats.last365d.incomeSaldo).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})):$(".row365d").hide(),document.title=(100*o.stats[e].energyPrice_kwh).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+"/kWh "+(-1*o.stats[e].incomeSaldo).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+"/Tag",void 0!==o.stats[e].saldo_wh){let t=0,i=0,s=0,a=0;for(let n=0;n<o.stats[e].saldo_wh.saldo.length;n++)o.stats[e].saldo_wh.saldo[n]>0?(t+=o.stats[e].saldo_wh.saldo[n],i++):(s+=o.stats[e].saldo_wh.saldo[n],a++);let n=0,l=0;i>0&&(n=t/i),a>0&&(l=s/a);let r='<table width="90%" style="width:90%"><tr style="height:5px;">',d=new Date(o.stats[e].saldo_wh.start).getDay();for(let t=0;t<o.stats[e].saldo_wh.saldo.length;t++){let i=(o.stats[e].saldo_wh.end-o.stats[e].saldo_wh.start)/o.stats[e].saldo_wh.saldo.length*t+o.stats[e].saldo_wh.start,s=new Date(i).toLocaleString();new Date(i).getDay()===d||"last7d"!=e&&"last30d"!=e||(d=new Date(i).getDay(),r+='</tr><tr style="height:5px;">'),o.stats[e].saldo_wh.saldo[t]>0?o.stats[e].saldo_wh.saldo[t]>n?r+='<td style="background-color:#FFA700" title="'+s+" Bezug:"+Math.abs(o.stats[e].saldo_wh.saldo[t])+' Wh"></td>':r+='<td style="background-color:#FFF6E4" title="'+s+" Bezug:"+Math.abs(o.stats[e].saldo_wh.saldo[t])+' Wh"></td>':o.stats[e].saldo_wh.saldo[t]<l?r+='<td style="background-color:#006c32" title="'+s+" Einspeisung:"+Math.abs(o.stats[e].saldo_wh.saldo[t])+' Wh"></td>':r+='<td style="background-color:#86df9b" title="'+s+" Einspeisung:"+Math.abs(o.stats[e].saldo_wh.saldo[t])+' Wh"></td>'}r+="</tr></table>",$("#trail").html(r),void 0!==o.latest.power_w&&($("#peerStatus").show(),o.latest.power_w>0?o.latest.power_w>n?$("#peerStatus").css("color","#ffa700"):$("#peerStatus").css("color","#FFDD98"):o.latest.power_w<l?$("#peerStatus").css("color","#006c32"):$("#peerStatus").css("color","#86df9b"),$("#peerStatus").attr("title",o.latest.power_w+"W"))}let n=$("#einnahmenChart"),l=[],r=[];if(l.push(o.stats[e].energySavingsSelf),r.push("Eigenstrom"),l.push(o.stats[e].energyIncome),r.push("Einspeisung"),l.push(o.stats[e].correntlyIncome),r.push("Corrently Erzeugung"),0!==$("#einnahmenChart").length)new Chart(n,{type:"doughnut",data:{datasets:[{label:"Einnahmen Verteilung",data:l,backgroundColor:["#006c32","#318b4e","#86df9b"]}],labels:r},options:{responsive:!0,legend:{position:"right"},plugins:{datalabels:{display:!0,color:"#000000",formatter:function(t,i){return(t/o.stats[e].energyRevenue*100).toFixed(1).replace(".",",")+"%"}}},title:{display:!1,text:""},animation:{animateScale:t,animateRotate:t},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(t,e){return r[t.index]+": "+e.datasets[0].data[t.index]+"€"}}},elements:{center:{text:o.stats[e].energyRevenue.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}),color:"#006C32",fontStyle:"Arial",sidePadding:20,minFontSize:20,lineHeight:25}}}});let d=$("#ausgabenChart"),m=[],g=[];m.push(o.stats[e].energyCost),g.push("Strombezug"),m.push(o.stats[e].amortization),g.push("Abschreibung"),m.push(o.stats[e].baseCosts),g.push("Grundgebühr");new Chart(d,{type:"doughnut",data:{datasets:[{label:"Ausgaben Verteilung",data:m,backgroundColor:["#FFA700","#FF8922","#FFF6E4"]}],labels:g},options:{responsive:!0,legend:{position:"left"},plugins:{datalabels:{display:!0,color:"#000000",formatter:function(t,i){return(t/o.stats[e].energySpendings*100).toFixed(1).replace(".",",")+"%"}}},title:{display:!1,text:""},animation:{animateScale:t,animateRotate:t},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(t,e){return g[t.index]+": "+e.datasets[0].data[t.index]+"€"}}},elements:{center:{text:o.stats[e].energySpendings.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}),color:"#FFA700",fontStyle:"Arial",sidePadding:20,minFontSize:20}}}});t&&setTimeout((function(){$("#info").addClass("show")}),2e3),t=!1;let c=o.stats[e].consumption_wh*o.meterinfo.energyPriceWh+o.stats[e].baseCosts,h=Math.round(1e4*(1- -1*o.stats[e].incomeSaldo/c))/100;a<(new Date).getTime()-6e4&&(window.swiper.slides&&window.swiper.slides.length>0&&window.swiper.removeAllSlides(),window.swiper.slides&&(window.swiper.appendSlide('<div class="blog-slider__item swiper-slide"><div class="blog-slider__content"><div class="blog-slider__title"><i class="fa fa-info-circle" style="  margin-right: 10px;"></i>Ausgaben</div><div class="blog-slider__text" id="info0"><strong>'+Math.round(o.stats[e].energyCost/o.stats[e].energySpendings*100)+"%</strong> der Kosten von "+o.stats[e].energySpendings.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+"€ für die Stromversorgung sind variabel, d.h. können durch den Verbrauch unmittelbar beeinflusst werden.</div></div></div>"),window.swiper.appendSlide('<div class="blog-slider__item swiper-slide"><div class="blog-slider__content"><div class="blog-slider__title"><i class="fa fa-wrench" style="  margin-right: 10px;"></i>Einnahmen</div><div class="blog-slider__text" id="info1">Steigere den Netzbezug zu Zeiten mit hohen Werten des GrünstromIndex, um die Erträge aus Corrently Erzeugung von derzeit <strong>'+o.stats[e].correntlyIncome.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+"€</strong> zu eröhen.</div></div></div>"),window.swiper.appendSlide('<div class="blog-slider__item swiper-slide"><div class="blog-slider__content"><div class="blog-slider__title"><i class="fa fa-tachometer" style="  margin-right: 10px;"></i>Ersparnis</div><div class="blog-slider__text" id="info1"><strong>'+h.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:2})+"%</strong> im Vergleich zu einem Anschluss ohne eigene Erzeugung, Speicher oder Corrently GrünstromBonus.</div></div></div>")),a=(new Date).getTime())}}catch(t){console.log(t),window.localStorage.removeItem("msg"),console.log("Removed stalled cached msg"),setTimeout((function(){r()}),1e3)}},r=function(){o=void 0!==window.localStorage.getItem("cid")&&null!==window.localStorage.getItem("cid")?"./p2p?method=msg&peer="+window.localStorage.getItem("cid"):"./msg",(n>20||0==n)&&$.getJSON(o,(function(t){window.localStorage.setItem("msg",JSON.stringify(t)),n=0,l()})).fail((function(){$.getJSON("https://casa-corrently-demo.herokuapp.com/"+o,(function(t){window.localStorage.setItem("msg",JSON.stringify(t)),n=0,l()}))})),n++};l(),setInterval(r,1e4),r()}));