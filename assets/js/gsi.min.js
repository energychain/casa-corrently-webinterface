$(document).ready((function(){let t="./msg",e=0;const s=function(){t=void 0!==window.localStorage.getItem("cid")&&null!==window.localStorage.getItem("cid")?"./p2p?method=msg&peer="+window.localStorage.getItem("cid"):"./msg",(e>20||0==e)&&$.getJSON(t,(function(t){window.localStorage.setItem("msg",JSON.stringify(t)),e=0,function(){if(void 0!==window.localStorage.getItem("msg")&&null!==window.localStorage.getItem("msg")){let e=JSON.parse(window.localStorage.getItem("msg"));void 0!==e.depot&&($("#gsbInfo").correntlySKOBalance(e.depot.account),$("#depot").correntlySKODepot(e.depot.account),$("#customsko").correntlyTreeBalance(e.depot.account),$("#hknchart").correntlyHKNChart(e.meterinfo.location.zip));let s="<tr><td class='small'>&#128197;</td>",l="<tr><td class='small'>&nbsp;</td>",a="<tr><td class='small'>&#128336;</td>",n="<tr><td class='small'>&#128336;</td>",o="<tr><td class='small'>&nbsp;</td>";for(var t=0;t<e.stats.next24h.prodWh.length;t++){let r=new Date(e.stats.next24h.prodWh[t].time);0==t||0==r.getHours()?s+="<td class='small tsclass' colspan='3'>"+r.getDate()+"."+(r.getMonth()+1)+"</td>":s+="<td>&nbsp;</td>";let d="bg-warning";e.stats.next24h.prodWh[t].nsi<48&&(d="bg-secondary"),e.stats.next24h.prodWh[t].nsi>52&&(d="bg-success"),l+="<td style='vertical-align:bottom' class='tsclass'><div class='"+d+"' title='Indexwert: "+e.stats.next24h.prodWh[t].nsi+" Punkte' style=';height:"+Math.round(2*e.stats.next24h.prodWh[t].nsi)+"px'></div></td>",a+="<td  class='"+d+" tsclass small' style='text-align:right'>"+r.getHours()+":00</td>",d="bg-warning",e.stats.next24h.prodWh[t].gsi<48&&(d="bg-secondary"),e.stats.next24h.prodWh[t].gsi>52&&(d="bg-success"),o+="<td style='vertical-align:bottom' class='tsclass'><div class='"+d+"' title='Indexwert: "+e.stats.next24h.prodWh[t].gsi+" Punkte' style=';height:"+Math.round(2*e.stats.next24h.prodWh[t].gsi)+"px'></div></td>",n+="<td  class='"+d+" tsclass small' style='text-align:right'>"+r.getHours()+":00</td>"}s+="</tr>",l+="</tr>",a+="</tr>",$("#nsiChart").html("<table class='table table-sm table-responsive gsiDataGiven'>"+l+s+a+"</table>"),$("#gsiChart").html("<table class='table table-sm table-responsive gsiDataGiven'>"+o+s+n+"</table>");let r={};for(let t=0;t<e.stats.next24h.prodWh.length&&t<24;t++){r["h_"+t]={time:e.stats.next24h.prodWh[t].time};let s=0,l=0;for(let a=t;a>0;a--)s+=e.stats.next24h.prodWh[t].nsi,l++,r["h_"+t]["avg_"+a]=Math.round(s/l);for(let s=t+1;s<e.stats.next24h.prodWh.length;s++)r["h_"+t]["avg_"+s]=!1}$("#btnSchedule").click((function(){$("#schedule").modal()}));let d='<table class="table table-sm table-responsive">';d+="<tr><th>Stunden</th><th>Einschalten</th><th>Ausschalten</th></tr>";for(let s=1;s<24;t++){let t=0,l=0;for(let a=s-1;a<24;a++)r["h_"+a]["avg_"+s]>l&&(l=r["h_"+a]["avg_"+s],t=e.stats.next24h.prodWh[a].time);let a="<tr>";a+="<td>"+s+"</td>",a+="<td>"+new Date(t).toLocaleTimeString()+"</td>",a+="<td>"+new Date(t+36e5*s).toLocaleTimeString()+"</td>";for(let s=0;s<24;s++)e.stats.next24h.prodWh[s].time>=t&&e.stats.next24h.prodWh[s].time<=t+36e5*s?a+="<td style='background:rgb(253,168,37);'>&nbsp;</td>":a+="<td style='background:rgb(12,109,52);'>&nbsp;</td>";a+="</tr>",console.log(a),d+=""+a}d+="</table>",$("#matrix").html(d)}}()})),e++};s(),setInterval(s,9e5)}));