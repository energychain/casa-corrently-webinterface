$(document).ready((function(){let t="./msg",e=0;const s=function(){t=void 0!==window.localStorage.getItem("cid")&&null!==window.localStorage.getItem("cid")?"./p2p?method=msg&peer="+window.localStorage.getItem("cid"):"./msg",(e>20||0==e)&&$.getJSON(t,(function(t){window.localStorage.setItem("msg",JSON.stringify(t)),e=0,function(){if(void 0!==window.localStorage.getItem("msg")&&null!==window.localStorage.getItem("msg")){let e=JSON.parse(window.localStorage.getItem("msg"));void 0!==e.depot&&($("#gsbInfo").correntlySKOBalance(e.depot.account),$("#depot").correntlySKODepot(e.depot.account),$("#customsko").correntlyTreeBalance(e.depot.account),$("#hknchart").correntlyHKNChart(e.meterinfo.location.zip));let s="<tr><td class='small'>&#128197;</td>",a="<tr><td class='small'>&nbsp;</td>",l="<tr><td class='small'>&#128336;</td>",n="<tr><td class='small'>&#128336;</td>",o="<tr><td class='small'>&nbsp;</td>";for(var t=0;t<e.stats.next24h.prodWh.length;t++){let r=new Date(e.stats.next24h.prodWh[t].time);0==t||0==r.getHours()?s+="<td class='small tsclass' colspan='3'>"+r.getDate()+"."+(r.getMonth()+1)+"</td>":s+="<td>&nbsp;</td>";let d="bg-warning";e.stats.next24h.prodWh[t].nsi<48&&(d="bg-secondary"),e.stats.next24h.prodWh[t].nsi>52&&(d="bg-success"),a+="<td style='vertical-align:bottom' class='tsclass'><div class='"+d+"' title='Indexwert: "+e.stats.next24h.prodWh[t].nsi+" Punkte' style=';height:"+Math.round(2*e.stats.next24h.prodWh[t].nsi)+"px'></div></td>",l+="<td  class='"+d+" tsclass small' style='text-align:right'>"+r.getHours()+":00</td>",d="bg-warning",e.stats.next24h.prodWh[t].gsi<48&&(d="bg-secondary"),e.stats.next24h.prodWh[t].gsi>52&&(d="bg-success"),o+="<td style='vertical-align:bottom' class='tsclass'><div class='"+d+"' title='Indexwert: "+e.stats.next24h.prodWh[t].gsi+" Punkte' style=';height:"+Math.round(2*e.stats.next24h.prodWh[t].gsi)+"px'></div></td>",n+="<td  class='"+d+" tsclass small' style='text-align:right'>"+r.getHours()+":00</td>"}s+="</tr>",a+="</tr>",l+="</tr>",$("#nsiChart").html("<table class='table table-sm table-responsive gsiDataGiven'>"+a+s+l+"</table>"),$("#gsiChart").html("<table class='table table-sm table-responsive gsiDataGiven'>"+o+s+n+"</table>");let r={};for(let t=0;t<e.stats.next24h.prodWh.length&&t<24;t++){r["h_"+t]={time:e.stats.next24h.prodWh[t].time};let s=0,a=0;for(let l=t;l>0;l--)s+=e.stats.next24h.prodWh[t].nsi,a++,r["h_"+t]["avg_"+l]=Math.round(s/a);for(let s=t+1;s<e.stats.next24h.prodWh.length;s++)r["h_"+t]["avg_"+s]=!1}$("#btnSchedule").click((function(){$("#schedule").modal()}));let d='<table class="table table-sm table-responsive">';d+="<tr><th>Stunden</th><th>Einschalten</th><th>Ausschalten</th></tr>";for(let t=1;t<24;t++){let s=0,a=0;for(let l=t-1;l<24;l++)r["h_"+l]["avg_"+t]>a&&(a=r["h_"+l]["avg_"+t],s=e.stats.next24h.prodWh[l].time);let l="<tr>";l+="<td>"+t+"</td>",l+="<td>"+new Date(s).toLocaleTimeString()+"</td>",l+="<td>"+new Date(s+36e5*t).toLocaleTimeString()+"</td>";for(let t=0;t<24;t++)e.stats.next24h.prodWh[t].time>=s&&e.stats.next24h.prodWh[t].time<=s+36e5*t?l+="<td style='background:rgb(253,168,37);'>&nbsp;</td>":l+="<td style='background:rgb(12,109,52);'>&nbsp;</td>";l+="</tr>",d+=""+l}d+="</table>",$("#matrix").html(d)}}()})),e++};s(),setInterval(s,9e5)}));